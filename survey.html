<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Reading Engagement and Evaluation of Literary Texts</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sora:wght@100..800&display=swap" rel="stylesheet">
    <style>
      body {
        background: linear-gradient(205deg, #FFA6B2 0%, #BABBFF 100%);
        min-height: 100vh;
        padding: 0rem  1rem 0rem 1rem;
        font-family: 'Sora', sans-serif;
      }
      .container {
        background: #DDE4ED;
        backdrop-filter: blur(12px);
        border-radius: 0px 0px 15px 15px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.30);
        padding: 2rem;
        max-width: 900px;
        position: sticky;
        top: 0; /* Stick to the top of the viewport */
        z-index: 10; /* Ensure it stays above other content */
      }
      h1 {
        color: #2c3e50;
        font-weight: 700;
        text-align: center;
        margin-bottom: 2rem;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      h2 {
        color: #34495e;
        font-weight: 600;
        border-bottom: 3px solid #FFA6B2;
        padding: 1rem;
        margin-bottom: 1.5rem;
        position: sticky;
        top: 0;
        background: rgba(255, 255, 255, 0.95);
        z-index: 10;
        border-radius: 10px;
      }
      .timer {
        position: fixed;
        top: 20px;
        right: 20px;
        background: rgba(52, 73, 94, 0.9);
        color: white;
        padding: 0.75rem 1.5rem;
        border-radius: 25px;
        font-weight: 600;
        backdrop-filter: blur(5px);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      }
      .excerpt {
        background: linear-gradient(145deg, #f8f9fa, #e9ecef);
        border-left: 4px solid #FFA3B7;
        padding: 1.5rem;
        margin: 1.5rem 0;
        border-radius: 10px;
        font-style: italic;
        line-height: 1.8;
        font-size: 1.1rem;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }
      .page {
        display: none;
        animation: fadeIn 0.5s ease-in-out;
      }
      .page.active {
        display: block;
      }
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .navigation {
        margin-top: 2rem;
        display: flex;
        justify-content: space-between;
        gap: 1rem;
      }
      .btn {
        border-radius: 25px;
        padding: 0.75rem 2rem;
        font-weight: 600;
        transition: all 0.3s ease;
        border: none;
        position: relative;
        overflow: hidden;
      }
      .btn::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        background: rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        transform: translate(-50%, -50%);
        transition: width 0.4s ease, height 0.4s ease;
      }
      .btn:hover::after {
        width: 200%;
        height: 200%;
      }
      .btn-primary {
        background: linear-gradient(45deg, #FF5761, #ABA3FF);
      }
      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
      }
      .btn-secondary {
        background: linear-gradient(45deg, #95a5a6, #7f8c8d);
      }
      .btn-success {
        background: linear-gradient(45deg, #27ae60, #2ecc71);
      }
      .btn-copy {
        background: linear-gradient(45deg, #6c757d, #5a6268);
      }
      .btn-copy:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(108, 117, 125, 0.4);
      }
      .form-control, .form-select {
        border-radius: 10px;
        border: 2px solid #ecf0f1;
        padding: 0.75rem;
        transition: all 0.3s ease;
        background: #fff;
      }
      .form-control:focus, .form-select:focus {
        border-color: #FFBDCF;
        box-shadow: 0 0 0 0.2rem rgba(255, 163, 183, 0.25);
      }
      .form-range {
        height: 6px;
        background: linear-gradient(to right, #e74c3c, #f39c12, #27ae60);
        border-radius: 3px;
      }
      .form-range::-webkit-slider-thumb {
        background: #3498db;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        border: 3px solid white;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
      }
      .form-range-value {
        font-weight: 600;
        color: #3498db;
      }
      .form-label {
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 0.5rem;
      }
      .form-check-input:checked {
        background-color: #3498db;
        border-color: #3498db;
      }
      .mb-3 {
        margin-bottom: 1.5rem !important;
      }
      .progress-container {
        margin-bottom: 1.5rem;
      }
      .progress {
        height: 10px;
        border-radius: 5px;
        background: #ecf0f1;
      }
      .progress-bar {
        background: linear-gradient(75deg, #FFA6B2, #D1CFFF);
        transition: width 0.3s ease;
      }
      .instructions {
        font-size: 1rem;
        color: #34495e;
        margin-bottom: 1.5rem;
        background: #f8f9fa;
        padding: 1rem;
        border-radius: 10px;
      }
      .invalid-feedback {
        display: none;
        color: #e74c3c;
        font-size: 0.875rem;
      }
      .is-invalid .invalid-feedback {
        display: block;
      }
      .is-invalid .form-control, .is-invalid .form-select {
        border-color: #e74c3c;
      }
      .likert-labels {
        display: flex;
        justify-content: space-between;
        font-size: 0.8rem;
        color: #2c3e50;
        margin-top: 0.5rem;
      }
    </style>
  </head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-3VT5FLC4H3"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
  
    gtag('config', 'G-3VT5FLC4H3');
  </script>
  <body>
    <div class="container">
      <h1>Reading Engagement and Evaluation of Literary Texts</h1>
      <div class="progress-container">
        <div class="progress">
          <div class="progress-bar" id="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
        </div>
      </div>
      <form id="survey-form">
        <div id="page-container"></div>
        
        <!-- Navigation buttons -->
        <div class="navigation">
          <button type="button" id="prevBtn" class="btn btn-secondary" disabled>Previous</button>
          <button type="button" id="nextBtn" class="btn btn-primary">Next</button>
          <button type="submit" id="submitBtn" class="btn btn-success" style="display:none;">Submit</button>
        </div>
      </form>
    </div>

    <script>
      // Page configuration
      const pageConfig = [
        {
          title: "Welcome!",
          customContent: true,
          content: `
            <p>Ever read something and thought, &ldquo;Wait&hellip; why am I obsessed with this?&rdquo; That&rsquo;s exactly the kind of magic we&rsquo;re studying.</p>

<p>We&rsquo;re running a quick survey to explore how people engage with different types of writing. You&rsquo;ll read a short literary excerpt&mdash;something intriguing, thought-provoking, maybe even goosebump-worthy&mdash;and then share your thoughts.</p>

<p>Here&rsquo;s the fun part:</p>

<ul>
    <li>The excerpt is actually <strong>really</strong> interesting (no snoozefest, we promise). </li>
    <li>Your honest impressions help us understand how readers connect with stories. </li>
    <li>It&rsquo;s totally anonymous&mdash;no names, just thoughts. Surveyswap karma points at the end.</li>
</ul>

<p>Got questions? Email <a href="mailto:vjaiswal28@gmail.com">vjaiswal28@gmail.com</a>.</p>

<p>So if you&rsquo;re curious, thoughtful, and have a few minutes to spare, jump in. Your brain + our story = research magic. Thanks for being awesome! </p> `
        },
        {
          title: "Demographics",
          instructions: "Please provide some background information about yourself.",
          fields: [
            { type: "number", id: "age", label: "Age", placeholder: "Enter your age", min: 1, required: true },
            { type: "select", id: "gender", label: "Gender", options: ["", "Female", "Male", "Non-binary", "Prefer not to say", "Other"], required: true },
            { type: "select", id: "education", label: "Highest level of education completed", options: ["", "No formal education", "In Elementary School", "Elementary School", "Middle School", "High School", "Some College", "Associates", "Bachelors", "Masters", "PhD/MD", "Postdoctoral"], required: true },
            { type: "select", id: "inschool", label: "Are you currently in school?", options: ["", "Yes", "No"], required:true },
            { type: "text", id: "field", label: "Academic or career field", placeholder: "e.g., Engineering", required: true },
            { type: "textarea", id: "language", label: "Add your languages (indicate whether you are comfortable speaking, reading, listening, writing for each)", placeholder: "e.g., English (speaking, reading, listening, writing), Spanish (reading, listening)", required: true },
            { type: "select", id: "country", label: "Country", options: ["", "United States", "Afghanistan", "Albania", "Algeria", "Andorra", "Angola", "Antigua and Barbuda", "Argentina", "Armenia", "Australia", "Austria", "Azerbaijan", "Bahamas", "Bahrain", "Bangladesh", "Barbados", "Belarus", "Belgium", "Belize", "Benin", "Bhutan", "Bolivia", "Bosnia and Herzegovina", "Botswana", "Brazil", "Brunei", "Bulgaria", "Burkina Faso", "Burundi", "Cabo Verde", "Cambodia", "Cameroon", "Canada", "Central African Republic", "Chad", "Chile", "China", "Colombia", "Comoros", "Congo, Democratic Republic of the", "Congo, Republic of the", "Costa Rica", "Croatia", "Cuba", "Cyprus", "Czech Republic", "Denmark", "Djibouti", "Dominica", "Dominican Republic", "East Timor", "Ecuador", "Egypt", "El Salvador", "Equatorial Guinea", "Eritrea", "Estonia", "Eswatini", "Ethiopia", "Fiji", "Finland", "France", "Gabon", "Gambia", "Georgia", "Germany", "Ghana", "Greece", " Grenada", "Guatemala", "Guinea", "Guinea-Bissau", "Guyana", "Haiti", "Honduras", "Hungary", "Iceland", "India", "Indonesia", "Iran", "Iraq", "Ireland", "Israel", "Italy", "Jamaica", "Japan", "Jordan", "Kazakhstan", "Kenya", "Kiribati", "Korea, North", "Korea, South", "Kosovo", "Kuwait", "Kyrgyzstan", "Laos", "Latvia", "Lebanon", "Lesotho", "Liberia", "Libya", "Liechtenstein", "Lithuania", "Luxembourg", "Madagascar", "Malawi", "Malaysia", "Maldives", "Mali", "Malta", "Marshall Islands", "Mauritania", "Mauritius", "Mexico", "Micronesia", "Moldova", "Monaco", "Mongolia", "Montenegro", "Morocco", "Mozambique", "Myanmar", "Namibia", "Nauru", "Nepal", "Netherlands", "New Zealand", "Nicaragua", "Niger", "Nigeria", "North Macedonia", "Norway", "Oman", "Pakistan", "Palau", "Panama", "Papua New Guinea", "Paraguay", "Peru", "Philippines", "Poland", "Portugal", "Qatar", "Romania", "Russia", "Rwanda", "Saint Kitts and Nevis", "Saint Lucia", "Saint Vincent and the Grenadines", "Samoa", "San Marino", "Sao Tome and Principe", "Saudi Arabia", "Senegal", "Serbia", "Seychelles", "Sierra Leone", "Singapore", "Slovakia", "Slovenia", "Solomon Islands", "Somalia", "South Africa", "South Sudan", "Spain", "Sri Lanka", "Sudan", "Suriname", "Sweden", "Switzerland", "Syria", "Taiwan", "Tajikistan", "Tanzania", "Thailand", "Togo", "Tonga", "Trinidad and Tobago", "Tunisia", "Turkey", "Turkmenistan", "Tuvalu", "Uganda", "Ukraine", "United Arab Emirates", "United Kingdom", "Uruguay", "Uzbekistan", "Vanuatu", "Vatican City", "Venezuela", "Vietnam", "Yemen", "Zambia", "Zimbabwe"], required: true },
            { type: "select", id: "reading_freq", label: "How often do you read?", options: ["", "Daily", "Weekly", "Monthly", "Rarely", "Never"], required: true }
          ]
        },
        {
          title: "Reading Excerpt",
          instructions: "Please read the following excerpt carefully.",
          customContent: true,
          content: `
            <div class="excerpt" id="excerpt-human" style="display: none;">
                <h3>The Open Window</h3>
                    <p>by a Human Author</p>
                    <p>"Then you know practically nothing about my aunt?" pursued the self-possessed young lady.</p>
                    <p>"Only her name and address," admitted the caller. He was wondering whether Mrs. Sappleton was in the married or widowed state. An undefinable something about the room seemed to suggest masculine habitation.</p>
                    <p>"Her great tragedy happened just three years ago," said the child; "that would be since your sister's time."</p>
                    <p>"Her tragedy?" asked Framton; somehow in this restful country spot tragedies seemed out of place.</p>
                    <p>"You may wonder why we keep that window wide open on an October afternoon," said the niece, indicating a large French window that opened on to a lawn.</p>
                    <p>"It is quite warm for the time of the year," said Framton; "but has that window got anything to do with the tragedy?"</p>
                    <p>"Out through that window, three years ago to a day, her husband and her two young brothers went off for their day's shooting. They never came back. In crossing the moor to their favourite snipe-shooting ground they were all three engulfed in a treacherous piece of bog. It had been that dreadful wet summer, you know, and places that were safe in other years gave way suddenly without warning. Their bodies were never recovered. That was the dreadful part of it." …</p>
                    <p>She broke off with a little shudder. It was a relief to Framton when the aunt bustled into the room with a whirl of apologies for being late in making her appearance.</p>
                    <p>"I hope Vera has been amusing you?" she said.</p>
                    <p>"She has been very interesting," said Framton.</p>
                    <p>"I hope you don't mind the open window," said Mrs. Sappleton briskly; "my husband and brothers will be home directly from shooting, and they always come in this way. They've been out for snipe in the marshes today, so they'll make a fine mess over my poor carpets. So like you menfolk, isn't it?"</p>
                    
            </div>
            <div class="excerpt" id="excerpt-ai" style="display: none;">
                  <h3>The Story of the Forgotten Chapel</h3>
                    <p>Generated by an AI</p>

                    <p>"You don’t know my father at all, do you?" asked the girl. "You’ve only heard of him through letters."</p>
                    <p>"Only that he’s a man of great repute," Mr. Turner said carefully, unsure of what else to add. "He’s a scholar, I believe?"</p>
                    <p>"Not exactly," she replied, her lips curling into a slight smile. "He’s more interested in things that are, forgotten. But I suppose that might be the same thing."</p>
                    <p>Mr. Turner’s curiosity piqued, but before he could ask further, the girl’s tone shifted. "My father’s great tragedy occurred several years ago. It was, unsettling, to say the least."</p>
                    <p>"Traged?" Mr. Turner asked, his brow furrowing. "What happened?"</p>
                    <p>She interrupted him, her voice taking on a slightly melancholic tone. "It was seven years ago, when Father’s closest friend came to visit. They were both keen on the history of the old chapel on the hill—at least, that’s what they told us. The day they ventured up there, they didn’t return. No one knows exactly what happened. Father came back, but his friend, well, he was never found"…</p>
                    <p>Mr. Turner couldn’t help but glance nervously toward the door. "And you, miss? Do you share your father's beliefs?"</p>
                    <p>She smiled faintly. "I don’t know what to believe. But I do know that the chapel is never truly empty. Not after what happened."</p>
                    <p>Before Mr. Turner could respond, a voice called from the hall. "Ah, Turner! You’ve met my daughter, I trust?"...</p>
                    <p>"I apologize for the wait," the father said, his voice deep and measured. "I trust my daughter has kept you entertained? We’ve had a long day of, well, discussions."...</p>
                    <p>"Yes," Mr. Turner replied, his mind racing. "She’s told me something about, your great loss."</p>
                    <p>The father’s face stiffened for a moment, then he chuckled softly. "Ah, yes. You’ve heard of the chapel, I take it?"</p>
                    <p>"I have," Mr. Turner replied, though he felt unsure how to proceed.</p>
                    <p>"Well, you needn’t worry. It’s nothing but old legends. Now, perhaps you’d like to join me for a walk before dinner. We’ll take the path by the chapel. It’ll clear your head. After all, there’s nothing to fear. Nothing at all."...</p>
                    <p>As they made their way toward the door, the girl gave him a long, unreadable look. "Do enjoy your walk," she said quietly…</p>
            </div>
            <div class="excerpt" id="excerpt-ai2" style="display: none;">
              <h3>The Story of the Forgotten Chapel</h3>

                    <p>"You don’t know my father at all, do you?" asked the girl. "You’ve only heard of him through letters."</p>
                    <p>"Only that he’s a man of great repute," Mr. Turner said carefully, unsure of what else to add. "He’s a scholar, I believe?"</p>
                    <p>"Not exactly," she replied, her lips curling into a slight smile. "He’s more interested in things that are, forgotten. But I suppose that might be the same thing."</p>
                    <p>Mr. Turner’s curiosity piqued, but before he could ask further, the girl’s tone shifted. "My father’s great tragedy occurred several years ago. It was, unsettling, to say the least."</p>
                    <p>"Tragedy?" Mr. Turner asked, his brow furrowing. "What happened?"</p>
                    <p>She interrupted him, her voice taking on a slightly melancholic tone. "It was seven years ago, when Father’s closest friend came to visit. They were both keen on the history of the old chapel on the hill—at least, that’s what they told us. The day they ventured up there, they didn’t return. No one knows exactly what happened. Father came back, but his friend, well, he was never found"…</p>
                    <p>Mr. Turner couldn’t help but glance nervously toward the door. "And you, miss? Do you share your father's beliefs?"</p>
                    <p>She smiled faintly. "I don’t know what to believe. But I do know that the chapel is never truly empty. Not after what happened."</p>
                    <p>Before Mr. Turner could respond, a voice called from the hall. "Ah, Turner! You’ve met my daughter, I trust?"...</p>
                    <p>"Yes," Mr. Turner replied, his mind racing. "She’s told me something about, your great loss."</p>
                    <p>The father’s face stiffened for a moment, then he chuckled softly. "Ah, yes. You’ve heard of the chapel, I take it?"</p>
                    <p>"I have," Mr. Turner replied, though he felt unsure how to proceed.</p>
                    <p>"Well, you needn’t worry. It’s nothing but old legends. Now, perhaps you’d like to join me for a walk before dinner. We’ll take the path by the chapel. It’ll clear your head. After all, there’s nothing to fear. Nothing at all."...</p>
                    <p>As they made their way toward the door, the girl gave him a long, unreadable look. "Do enjoy your walk," she said quietly…</p>
            </div>
            <div class="excerpt" id="excerpt-human2" style="display: none;">
              <h3>The Open Window</h3>
                    <p>"Then you know practically nothing about my aunt?" pursued the self-possessed young lady.</p>
                    <p>"Only her name and address," admitted the caller. He was wondering whether Mrs. Sappleton was in the married or widowed state. An undefinable something about the room seemed to suggest masculine habitation.</p>
                    <p>"Her great tragedy happened just three years ago," said the child; "that would be since your sister's time."</p>
                    <p>"Her tragedy?" asked Framton; somehow in this restful country spot tragedies seemed out of place.</p>
                    <p>"You may wonder why we keep that window wide open on an October afternoon," said the niece, indicating a large French window that opened on to a lawn.</p>
                    <p>"It is quite warm for the time of the year," said Framton; "but has that window got anything to do with the tragedy?"</p>
                    <p>"Out through that window, three years ago to a day, her husband and her two young brothers went off for their day's shooting. They never came back. In crossing the moor to their favourite snipe-shooting ground they were all three engulfed in a treacherous piece of bog. It had been that dreadful wet summer, you know, and places that were safe in other years gave way suddenly without warning. Their bodies were never recovered. That was the dreadful part of it." …</p>
                    <p>She broke off with a little shudder. It was a relief to Framton when the aunt bustled into the room with a whirl of apologies for being late in making her appearance.</p>
                    <p>"I hope Vera has been amusing you?" she said.</p>
                    <p>"She has been very interesting," said Framton.</p>
                    <p>"I hope you don't mind the open window," said Mrs. Sappleton briskly; "my husband and brothers will be home directly from shooting, and they always come in this way. They've been out for snipe in the marshes today, so they'll make a fine mess over my poor carpets. So like you menfolk, isn't it?"</p>
                  
            </div>
          `
        },
        {
          title: "Reading Experience & Engagement",
          instructions: "Rate your experience and engagement with the text you just read.",
          fields: [
            { type: "range", id: "auth1", label: "The writing felt generic and didn’t show a personal point of view.", min: 1, max: 7, value: 4, required: true },
            { type: "range", id: "auth2", label: "The writing reflected a perspective shaped by personal experiences.", min: 1, max: 7, value: 4, required: true },
            { type: "range", id: "auth3", label: "The emotional tone of the story felt authentic to the author’s perspective.", min: 1, max: 7, value: 4, required: true },
            { type: "range", id: "auth4", label: "The story felt more like a collection of words than a meaningful message.", min: 1, max: 7, value: 4, required: true },
            { type: "range", id: "auth5", label: "The writing conveyed a sense of emotional depth.", min: 1, max: 7, value: 4, required: true },
            { type: "range", id: "emo1", label: "How did this story make you feel emotionally?", min: 1, max: 7, value: 4, labels: { "1": "Very negative", "5": "Very positive" }, required: true },
            { type: "range", id: "emo2", label: "How activated or stimulated did you feel while reading?", min: 1, max: 7, value: 4, labels: { "1": "Very calm/bored", "5": "Very alert/intense" }, required: true },
            { type: "checkboxes", id: "emo3", label: "What emotions did you experience while reading?", options: [
                { label: "Curiosity", value: "curiosity" },
                { label: "Suspense", value: "suspense" },
                { label: "Amusement", value: "amusement" },
                { label: "Surprise", value: "surprise" },
                { label: "Discomfort", value: "discomfort" },
                { label: "Sadness", value: "sadness" },
                { label: "Anxiety", value: "anxiety" },
                { label: "Disappointment", value: "disappointment" },
                { label: "None of the above", value: "none" },
                { label: "Other", value: "other", text: true }
              ], required: true },
            { type: "range", id: "exp1", label: "I felt a pull to keep reading…", min: 1, max: 7, value: 4, required: true },
            { type: "range", id: "exp2", label: "The events and characters felt real to me.", min: 1, max: 7, value: 4, required: true },
            { type: "range", id: "exp3", label: "I felt a sense of connection to the characters.", min: 1, max: 7, value: 4, required: true },
            { type: "range", id: "exp4", label: "Narrative flow was smooth.", min: 1, max: 7, value: 4, required: true },
            { type: "range", id: "exp5", label: "I felt the intended mood or tone.", min: 1, max: 7, value: 4, required: true },
            { type: "range", id: "exp6", label: "How likely are you to read the rest?", min: 1, max: 7, value: 4, required: true }
          ]
        },
        {
          title: "Literary Quality & Appreciation",
          instructions: "Evaluate the literary quality of the text you read.",
          fields: [
            { type: "range", id: "lit1", label: "How vivid were the images?", min: 1, max: 7, value: 4, required: true },
            { type: "range", id: "lit2", label: "How well did characters' thoughts come through?", min: 1, max: 7, value: 4, required: true },
            { type: "range", id: "lit3", label: "How precise were word choices?", min: 1, max: 7, value: 4, required: true },
            { type: "range", id: "lit4", label: "How compelling were character interactions?", min: 1, max: 7, value: 4, required: true },
            { type: "range", id: "lit5", label: "To what extent did the author's voice come through?", min: 1, max: 7, value: 4, required: true },
            { type: "range", id: "lit6", label: "To what extent did the writing feel genuine?", min: 1, max: 7, value: 4, required: true },
            { type: "textarea", id: "lit7", label: "What moment/image/feeling stuck with you most?" }
          ]
        },
        {
          title: "Perceived Source",
          titleId: "authorship-title",
          instructions: "Based on the style and content of the excerpt, please provide your best guess about its origin and answer the related questions.",
          customContent: true,
          content: `
            <div id="authorship-info" style="display: none;">
              <div class="instructions">Please answer the following questions about the source of the text.</div>
              <div class="mb-3">
                <label for="recall_source" class="form-label">Please indicate what you recall about the source of the text:</label>
                <select id="recall_source" name="recall_source" class="form-select">
                  <option value="">Select an option…</option>
                  <option>The text was identified as from a human author</option>
                  <option>The text was identified as from an artificial intelligence (AI) system</option>
                </select>
                <div class="invalid-feedback">Please select an option.</div>
              </div>
              <div class="mb-3">
                <label for="influence_engagement" class="form-label">To what extent did this information influence your engagement with the text? <span class="form-range-value" id="influence_engagement-value">4</span></label>
                <input type="range" id="influence_engagement" name="influence_engagement" class="form-range" min="1" max="7" value="4" oninput="document.getElementById('influence_engagement-value').innerText = this.value" />
                <div class="likert-labels">
                  <span>1 (Not at all)</span>
                  <span>2</span>
                  <span>3</span>
                  <span>4 (Neutral)</span>
                  <span>5</span>
                  <span>6</span>
                  <span>7 (Very much)</span>
                </div>
                <div class="invalid-feedback">Please adjust the slider.</div>
              </div>
              <div class="mb-3">
                <label for="influence_quality" class="form-label">To what extent did this information influence your perception of the text’s quality? <span class="form-range-value" id="influence_quality-value">4</span></label>
                <input type="range" id="influence_quality" name="influence_quality" class="form-range" min="1" max="7" value="4" oninput="document.getElementById('influence_quality-value').innerText = this.value" />
                <div class="likert-labels">
                  <span>1 (Not at all)</span>
                  <span>2</span>
                  <span>3</span>
                  <span>4 (Neutral)</span>
                  <span>5</span>
                  <span>6</span>
                  <span>7 (Very much)</span>
                </div>
                <div class="invalid-feedback">Please adjust the slider.</div>
              </div>
              <div class="mb-3">
                <label for="influence_emotion" class="form-label">In what ways, if any, did this information affect your emotional connection to the text?</label>
                <textarea id="influence_emotion" name="influence_emotion" class="form-control"></textarea>
              </div>
              <div class="mb-3">
                <label for="confidence_evaluation" class="form-label">How confident do you feel in your evaluation of the text given the information you received about its source? <span class="form-range-value" id="confidence_evaluation-value">4</span></label>
                <input type="range" id="confidence_evaluation" name="confidence_evaluation" class="form-range" min="1" max="7" value="4" oninput="document.getElementById('confidence_evaluation-value').innerText = this.value" />
                <div class="likert-labels">
                  <span>1 (Not at all)</span>
                  <span>2</span>
                  <span>3</span>
                  <span>4 (Neutral)</span>
                  <span>5</span>
                  <span>6</span>
                  <span>7 (Very confident)</span>
                </div>
                <div class="invalid-feedback">Please adjust the slider.</div>
              </div>
            </div>
            <div id="perceived-source" style="display: none;">
              <div class="instructions">Based on the style and content of the excerpt, please provide your best guess about its origin and answer the related questions.</div>
              <div class="mb-3">
                <label for="originguess" class="form-label">Based on the style and content of this excerpt, what is your best guess about how it was created?</label>
                <select id="originguess" name="originguess" class="form-select">
                  <option value="">Select origin…</option>
                  <option>Written by a human author</option>
                  <option>Written by an Artificial Intelligence (AI)</option>
                  <option>Unsure</option>
                </select>
                <div class="invalid-feedback">Please select an option.</div>
              </div>
              <div class="mb-3">
                <label for="ai_likelihood" class="form-label">To what extent do you believe this excerpt was written by an Artificial Intelligence (AI)? <span id="ai_likelihood-value">50%</span></label>
                <input type="range" id="ai_likelihood" name="ai_likelihood" class="form-range" min="0" max="100" value="50" oninput="document.getElementById('ai_likelihood-value').innerText = this.value + '%'" />
                <div class="likert-labels">
                  <span>0% (Definitely not AI)</span>
                  <span>25%</span>
                  <span>50% (Unsure)</span>
                  <span>75%</span>
                  <span>100% (Definitely AI)</span>
                </div>
                <div class="invalid-feedback">Please adjust the slider.</div>
              </div>
              <div class="mb-3">
                <label for="confidence_origin" class="form-label">How confident are you in your choice about the author's origin (human/AI)? <span class="form-range-value" id="confidence_origin-value">4</span></label>
                <input type="range" id="confidence_origin" name="confidence_origin" class="form-range" min="1" max="7" value="4" oninput="document.getElementById('confidence_origin-value').innerText = this.value" />
                <div class="likert-labels">
                  <span>1 (Not at all)</span>
                  <span>2</span>
                  <span>3</span>
                  <span>4 (Neutral)</span>
                  <span>5</span>
                  <span>6</span>
                  <span>7 (Very confident)</span>
                </div>
                <div class="invalid-feedback">Please adjust the slider.</div>
              </div>
              <div class="mb-3">
                <label class="form-label">If you considered that this excerpt might have been written by an AI, what emotions did you experience? (check at least one):</label>
                <br />
                ${["Curiosity", "Surprise", "Disappointment", "Amusement", "Skepticism", "Admiration", "Concern", "Annoyance", "None of the above", "Other"].map((opt, index) => `
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" name="ai_emotions" value="${opt}" id="ai_emotions_${index}" />
                    <label class="form-check-label" for="ai_emotions_${index}">${opt}</label>
                  </div>
                `).join('')}
                <div class="invalid-feedback" id="ai_emotions_feedback">Please select at least one emotion.</div>
                <div class="mt-2" id="other_emotion_container" style="display: none;">
                  <label for="other_emotion" class="form-label">Please specify other emotions:</label>
                  <input type="text" id="other_emotion" name="other_emotion" class="form-control" placeholder="Specify other emotions..." />
                  <div class="invalid-feedback">Please specify the other emotion.</div>
                </div>
              </div>
              <div class="mb-3">
                <label for="origin_explanation" class="form-label">Please explain why you made your choice about the author's origin. What specific aspects of the writing (e.g., word choice, sentence structure, emotional tone, character dialogue, plot development) led you to your guess?</label>
                <textarea id="origin_explanation" name="origin_explanation" class="form-control"></textarea>
                <div class="invalid-feedback">Please provide an explanation.</div>
              </div>
              <div class="mb-3">
                <label for="distinct_expression" class="form-label">To what extent did this text feel like it was written by an individual with a distinct, personal way of expressing themselves? <span class="form-range-value" id="distinct_expression-value">4</span></label>
                <input type="range" id="distinct_expression" name="distinct_expression" class="form-range" min="1" max="7" value="4" oninput="document.getElementById('distinct_expression-value').innerText = this.value" />
                <div class="likert-labels">
                  <span>1 (Not at all)</span>
                  <span>2</span>
                  <span>3</span>
                  <span>4 (Neutral)</span>
                  <span>5</span>
                  <span>6</span>
                  <span>7 (Very much)</span>
                </div>
                <div class="invalid-feedback">Please adjust the slider.</div>
              </div>
              <div class="mb-3">
                <label for="originality_influence" class="form-label">To what extent did the text's (lack of) originality/creativity influence your guess? <span class="form-range-value" id="originality_influence-value">4</span></label>
                <input type="range" id="originality_influence" name="originality_influence" class="form-range" min="1" max="7" value="4" oninput="document.getElementById('originality_influence-value').innerText = this.value" />
                <div class="likert-labels">
                  <span>1 (Not at all)</span>
                  <span>2</span>
                  <span>3</span>
                  <span>4 (Neutral)</span>
                  <span>5</span>
                  <span>6</span>
                  <span>7 (Very much)</span>
                </div>
                <div class="invalid-feedback">Please adjust the slider.</div>
              </div>
              <div class="mb-3">
                <label for="emotion_nuance_influence" class="form-label">To what extent did the text's (lack of) specific human emotion/nuance influence your guess? <span class="form-range-value" id="emotion_nuance_influence-value">4</span></label>
                <input type="range" id="emotion_nuance_influence" name="emotion_nuance_influence" class="form-range" min="1" max="7" value="4" oninput="document.getElementById('emotion_nuance_influence-value').innerText = this.value" />
                <div class="likert-labels">
                  <span>1 (Not at all)</span>
                  <span>2</span>
                  <span>3</span>
                  <span>4 (Neutral)</span>
                  <span>5</span>
                  <span>6</span>
                  <span>7 (Very much)</span>
                </div>
                <div class="invalid-feedback">Please adjust the slider.</div>
              </div>
              <div class="mb-3">
                <label for="structured_language_influence" class="form-label">To what extent did the text's (overly) structured/formulaic language influence your guess? <span class="form-range-value" id="structured_language_influence-value">4</span></label>
                <input type="range" id="structured_language_influence" name="structured_language_influence" class="form-range" min="1" max="7" value="4" oninput="document.getElementById('structured_language_influence-value').innerText = this.value" />
                <div class="likert-labels">
                  <span>1 (Not at all)</span>
                  <span>2</span>
                  <span>3</span>
                  <span>4 (Neutral)</span>
                  <span>5</span>
                  <span>6</span>
                  <span>7 (Very much)</span>
                </div>
                <div class="invalid-feedback">Please adjust the slider.</div>
              </div>
              <div class="mb-3">
                <label for="word_choice_influence" class="form-label">To what extent did the text's (unusual/too perfect) word choice or grammar influence your guess? <span class="form-range-value" id="word_choice_influence-value">4</span></label>
                <input type="range" id="word_choice_influence" name="word_choice_influence" class="form-range" min="1" max="7" value="4" oninput="document.getElementById('word_choice_influence-value').innerText = this.value" />
                <div class="likert-labels">
                  <span>1 (Not at all)</span>
                  <span>2</span>
                  <span>3</span>
                  <span>4 (Neutral)</span>
                  <span>5</span>
                  <span>6</span>
                  <span>7 (Very much)</span>
                </div>
                <div class="invalid-feedback">Please adjust the slider.</div>
              </div>
              <div class="mb-3">
                <label for="consistency_influence" class="form-label">To what extent did the text's consistency (or lack thereof) in tone/style influence your guess? <span class="form-range-value" id="consistency_influence-value">4</span></label>
                <input type="range" id="consistency_influence" name="consistency_influence" class="form-range" min="1" max="7" value="4" oninput="document.getElementById('consistency_influence-value').innerText = this.value" />
                <div class="likert-labels">
                  <span>1 (Not at all)</span>
                  <span>2</span>
                  <span>3</span>
                  <span>4 (Neutral)</span>
                  <span>5</span>
                  <span>6</span>
                  <span>7 (Very much)</span>
                </div>
                <div class="invalid-feedback">Please adjust the slider.</div>
              </div>
            </div>
          `
        },
        {
          title: "Artificial Intelligence",
          instructions: "Share your thoughts on AI-generated text.",
          fields: [
            { type: "range", id: "trust1", label: "How much do you trust AI-generated text?", min: 1, max: 7, value: 4, required: true },
            { type: "range", id: "trust2", label: "Do you believe AI can express empathy?", min: 1, max: 7, value: 4, required: true },
            { type: "range", id: "trust3", label: "Do you feel a personal connection to AI text?", min: 1, max: 7, value: 4, required: true },
            { type: "range", id: "trust4", label: "How comfortable are you reading AI content?", min: 1, max: 7, value: 4, required: true },
            { type: "range", id: "trust5", label: "Can AI produce truly original writing?", min: 1, max: 7, value: 4, required: true },
            { type: "range", id: "trust6", label: "AI-generated content is generally trustworthy.", min: 1, max: 7, value: 4, required: true },
            { type: "range", id: "trust7", label: "I feel uneasy when I can’t tell if something was written by AI.", min: 1, max: 7, value: 4, required: true }
          ]
        },
        {
          title: "Familiarity with Technology",
          instructions: "Tell us about your experience with AI technology.",
          fields: [
            { type: "select", id: "ai_use_freq", label: "How often do you use AI language models?", options: ["", "Daily", "Weekly", "Monthly", "Rarely", "Never"], required: true },
            { type: "checkbox-group", id: "ai_uses", label: "What do you use AI for? (check all):", options: [
                "Writing", "Summarizing information", "Brainstorming ideas", "Research", "Coding", "Translation", "Personal learning", "I do not use AI language models"
              ], required: true },
            { type: "text", id: "ai_use_other", label: "Other AI uses (if any):", placeholder: "Specify other uses..." },
            { type: "range", id: "ai_encounter", label: "How often do you encounter AI-generated text?", min: 1, max: 7, value: 4, required: true },
            { type: "range", id: "ai_capable", label: "How capable is AI of producing high-quality writing?", min: 1, max: 7, value: 4, required: true },
            { type: "range", id: "ai_concern", label: "How concerned are you about ethical use of AI text?", min: 1, max: 7, value: 4, required: true },
            { type: "range", id: "ai_dependence", label: "I rely on AI to help me with complex tasks.", min: 1, max: 7, value: 4, required: true },
            { type: "range", id: "ai_control", label: "I believe humans should always have final say over AI-generated writing.", min: 1, max: 7, value: 4, required: true }
          ]
        },
        {
          title: "Final Questions",
          instructions: "Please rate how much each statement describes you.",
          fields: [
            { type: "range", id: "nfc1", label: "I prefer complex to simple problems.", min: 1, max: 7, value: 4, required: true },
            { type: "range", id: "nfc2", label: "I really enjoy a task that involves coming up with new solutions to problems.", min: 1, max: 7, value: 4, required: true },
            { type: "range", id: "nfc3", label: "Thinking is not my idea of fun.", min: 1, max: 7, value: 4, required: true },
            { type: "range", id: "nfc4", label: "I only think as hard as I have to.", min: 1, max: 7, value: 4, required: true },
            { type: "select", id: "read_before", label: "Have you read this text before?", options: ["", "Yes", "No", "Unsure"], required: true }
          ]
        },
        {
          title: "Thank you!",
          customContent: true,
          content: `
            <p>The following code gives you Karma that can be used at SurveySwap.io. 
 
Go to: https://surveyswap.io/sr/94R0-PMON-3YCL 
 
Or, alternatively, enter code manually: 1XO7-CMNS-9FKA  
 
Here is something you might find interesting: </p>
            <a href = "https://youtu.be/okHkUIW46ks?si=_JLJQh09kNKhZMUy" target="_blank"> How to Remember Everything You Read (Youtube Link)</a>
            `
        }
      ];

      // Field generation functions
      const createField = (field) => {
        const div = document.createElement('div');
        div.className = 'mb-3';
        
        switch(field.type) {
          case 'text':
          case 'number':
            div.innerHTML = `
              <label for="${field.id}" class="form-label">${field.label}</label>
              <input type="${field.type}" id="${field.id}" name="${field.id}" class="form-control" 
                     ${field.placeholder ? `placeholder="${field.placeholder}"` : ''}
                     ${field.min ? `min="${field.min}"` : ''}
                     ${field.max ? `max="${field.max}"` : ''}
                     ${field.required ? 'required' : ''} />
              <div class="invalid-feedback">Please ${field.type === 'number' ? 'enter a valid number' : 'fill in this field'}.</div>
            `;
            break;
            
          case 'select':
            const options = field.options.map(opt => `<option value="${opt}">${opt}</option>`).join('');
            div.innerHTML = `
              <label for="${field.id}" class="form-label">${field.label}</label>
              <select id="${field.id}" name="${field.id}" class="form-select" ${field.required ? 'required' : ''}>
                ${options}
              </select>
              <div class="invalid-feedback">Please select an option.</div>
            `;
            break;
            
          case 'range':
            div.innerHTML = `
              <label for="${field.id}" class="form-label">${field.label} <span class="form-range-value" id="${field.id}-value">${field.value}</span></label>
              <input type="range" id="${field.id}" name="${field.id}" class="form-range" 
                     min="${field.min}" max="${field.max}" value="${field.value}" ${field.required ? 'required' : ''}
                     oninput="document.getElementById('${field.id}-value').innerText = this.value" />
              <div class="likert-labels">
                <span>1 (Not at all)</span>
                <span>2</span>
                <span>3</span>
                <span>4 (Neutral)</span>
                <span>5</span>
                <span>6</span>
                <span>7 (Very much)</span>
              </div>
              <div class="invalid-feedback">Please adjust the slider.</div>
            `;
            break;
            
          case 'textarea':
            div.innerHTML = `
              <label for="${field.id}" class="form-label">${field.label}</label>
              <textarea id="${field.id}" name="${field.id}" class="form-control" ${field.required ? 'required' : ''} ${field.placeholder ? `placeholder="${field.placeholder}"` : ''}></textarea>
              <div class="invalid-feedback">Please provide a response.</div>
            `;
            break;
            
          case 'checkbox-group':
          case 'checkboxes':
            const checkboxes = field.options.map((opt, index) => `
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="checkbox" name="${field.id}" value="${opt.value || opt}" id="${field.id}_${index}" />
                <label class="form-check-label" for="${field.id}_${index}">${opt.label || opt}</label>
              </div>
            `).join('');
            div.innerHTML = `
              <label class="form-label">${field.label}</label>
              <br />
              ${checkboxes}
              <div class="invalid-feedback">Please select at least one option.</div>
            `;
            break;
        }
        
        return div;
      };

      // Generate pages
      const generatePages = () => {
        const container = document.getElementById('page-container');
        
        pageConfig.forEach((page, index) => {
          const pageDiv = document.createElement('div');
          pageDiv.className = 'page';
          pageDiv.setAttribute('data-page', index + 1);
          
          const title = document.createElement('h2');
          title.textContent = page.title;
          if (page.titleId) title.id = page.titleId;
          pageDiv.appendChild(title);
          
          if (page.instructions && !page.customContent) {
            const instructions = document.createElement('div');
            instructions.className = 'instructions';
            instructions.textContent = page.instructions;
            instructions.id = index + 1 === pageConfig.length ? 'conclusion-text' : '';
            pageDiv.appendChild(instructions);
          }
          
          if (page.customContent) {
            pageDiv.innerHTML += page.content;
          } else if (page.fields) {
            page.fields.forEach(field => {
              pageDiv.appendChild(createField(field));
            });
          }
          
          container.appendChild(pageDiv);
        });
      };

      // Initialize
      generatePages();

      // Get survey number from URL query parameter
      const urlParams = new URLSearchParams(window.location.search);
      const surveyNum = urlParams.get('survey') || '1';

      // Configure excerpt and authorship section based on survey number
      const excerptHuman = document.getElementById('excerpt-human');
      const excerptAI = document.getElementById('excerpt-ai');
      const excerptAI2 = document.getElementById('excerpt-ai2');
      const excerptHuman2 = document.getElementById('excerpt-human2');
      const authorshipTitle = document.getElementById('authorship-title');
      const perceivedSource = document.getElementById('perceived-source');
      const authorshipInfo = document.getElementById('authorship-info');

      // Reset display to ensure no conflicts
      excerptHuman.style.display = 'none';
      excerptAI.style.display = 'none';
      excerptAI2.style.display = 'none';
      excerptHuman2.style.display = 'none';
      perceivedSource.style.display = 'none';
      authorshipInfo.style.display = 'none';

      if (surveyNum === '1') {
        excerptHuman.style.display = 'block';
        authorshipInfo.style.display = 'block';
        authorshipTitle.innerText = 'Effect of Authorship Information';
        pageConfig[5].instructions = 'Please answer the following questions about the source of the text.';
      } else if (surveyNum === '2') {
        excerptAI.style.display = 'block';
        authorshipInfo.style.display = 'block';
        authorshipTitle.innerText = 'Effect of Authorship Information';
        pageConfig[5].instructions = 'Please answer the following questions about the source of the text.';
      } else if (surveyNum === '3') {
        excerptAI2.style.display = 'block';
        perceivedSource.style.display = 'block';
        authorshipTitle.innerText = 'Perceived Source';
        pageConfig[5].instructions = 'Based on the style and content of the excerpt, please provide your best guess about its origin and answer the related questions.';
      } else if (surveyNum === '4') {
        excerptHuman2.style.display = 'block';
        perceivedSource.style.display = 'block';
        authorshipTitle.innerText = 'Perceived Source';
        pageConfig[5].instructions = 'Based on the style and content of the excerpt, please provide your best guess about its origin and answer the related questions.';
      }

      // Toggle other_emotion input based on checkbox selection
      document.addEventListener('change', (e) => {
        if (e.target.matches('input[name="ai_emotions"]')) {
          const otherCheckbox = document.getElementById('ai_emotions_9');
          const otherContainer = document.getElementById('other_emotion_container');
          const otherInput = document.getElementById('other_emotion');
          otherContainer.style.display = otherCheckbox.checked ? 'block' : 'none';
          if (!otherCheckbox.checked) otherInput.value = '';
        }
      });

      // Page navigation and timing variables
      let currentPage = 1;
      const totalPages = pageConfig.length;
      let startTime = Date.now();
      let readingPageStartTime = null;
      let readingPageTime = null;
      let pageStartTime = null;
      let pageTimes = new Array(pageConfig.length).fill(0);
      let navigationEvents = [];

      // Device and browser detection
      function getDeviceType() {
        const ua = navigator.userAgent;
        if (/mobile/i.test(ua)) return "mobile";
        if (/tablet/i.test(ua)) return "tablet";
        return "desktop";
      }

      function getBrowserType() {
        const ua = navigator.userAgent;
        if (/chrome/i.test(ua)) return "Chrome";
        if (/firefox/i.test(ua)) return "Firefox";
        if (/safari/i.test(ua)) return "Safari";
        if (/edge/i.test(ua)) return "Edge";
        return "Other";
      }

      // Page navigation
      const showPage = n => {
        if (pageStartTime && currentPage <= pageTimes.length) {
          pageTimes[currentPage - 1] = ((Date.now() - pageStartTime) / 1000).toFixed(1);
        }
        if (currentPage === 3 && readingPageStartTime) {
          readingPageTime = ((Date.now() - readingPageStartTime) / 1000).toFixed(1);
        }
        if (n === 3) {
          readingPageStartTime = Date.now();
        }
        pageStartTime = Date.now();

        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        const currentPageElement = document.querySelector(`.page[data-page="${n}"]`);
        currentPageElement.classList.add('active');
        const prevBtn = document.getElementById('prevBtn');
        prevBtn.disabled = (n === 1);
        prevBtn.className = n === 1 ? 'btn btn-secondary' : 'btn btn-primary';
        document.getElementById('nextBtn').style.display = (n === totalPages ? 'none' : 'inline-block');
        document.getElementById('submitBtn').style.display = (n === totalPages ? 'inline-block' : 'none');
        
        // Update progress bar
        const progress = ((n / totalPages) * 100).toFixed(0);
        const progressBar = document.getElementById('progress-bar');
        progressBar.style.width = `${progress}%`;
        progressBar.setAttribute('aria-valuenow', progress);
        
        // Update instructions dynamically
        const instructions = currentPageElement.querySelector('.instructions');
        if (instructions && pageConfig[n-1].instructions && !pageConfig[n-1].customContent) {
          instructions.textContent = pageConfig[n-1].instructions;
        }
      };

      // Validate current page
      const validatePage = (pageNum, showErrors = false) => {
        const page = document.querySelector(`.page[data-page="${pageNum}"]`);
        if (pageNum === 1 || pageNum === 6 || pageNum === totalPages) return true;
        
        const requiredInputs = page.querySelectorAll('input[required], select[required], textarea[required]');
        let allValid = true;
        
        if (showErrors) {
          page.querySelectorAll('.is-invalid').forEach(el => el.classList.remove('is-invalid'));
        }
        
        requiredInputs.forEach(input => {
          let isValid = true;
          if (input.type === 'number') {
            const value = parseInt(input.value);
            const min = parseInt(input.min);
            if (!input.value || isNaN(value) || value < min) {
              isValid = false;
            }
          } else if (input.type === 'range') {
            const value = parseInt(input.value);
            const min = parseInt(input.min);
            const max = parseInt(input.max);
            if (!input.value || isNaN(value) || value < min || value > max) {
              isValid = false;
            }
          } else if (input.tagName === 'SELECT') {
            if (!input.value) {
              isValid = false;
            }
          } else if (!input.value || input.value.trim() === '') {
            isValid = false;
          }
          
          if (!isValid && showErrors) {
            input.parentElement.classList.add('is-invalid');
            allValid = false;
          }
        });
        
        // Validate checkbox groups
        const checkboxGroups = page.querySelectorAll('input[type="checkbox"][name]');
        const uniqueNames = new Set(Array.from(checkboxGroups).map(input => input.name));
        uniqueNames.forEach(name => {
          const checkboxes = page.querySelectorAll(`input[name="${name}"]:checked`);
          const container = page.querySelector(`input[name="${name}"]`).parentElement;
          
          if (checkboxes.length === 0 && showErrors) {
            container.classList.add('is-invalid');
            allValid = false;
          } else if (showErrors) {
            container.classList.remove('is-invalid');
          }
        });
        
        return allValid;
      };

      // Navigation event handlers
      document.getElementById('nextBtn').onclick = () => {
        if (validatePage(currentPage, true)) {
          navigationEvents.push({ event: "next", fromPage: currentPage, timestamp: new Date().toISOString() });
          currentPage++;
          showPage(currentPage);
        }
      };
      
      document.getElementById('prevBtn').onclick = () => {
        navigationEvents.push({ event: "previous", fromPage: currentPage, timestamp: new Date().toISOString() });
        currentPage--;
        showPage(currentPage);
      };

      // Copy button functionality
      document.addEventListener('click', (e) => {
        if (e.target.id === 'copyBtn') {
          const conclusionText = document.getElementById('conclusion-text').textContent;
          navigator.clipboard.writeText(conclusionText).then(() => {
            alert('Conclusion text copied to clipboard!');
          }).catch(err => {
            console.error('Failed to copy text: ', err);
            alert('Failed to copy text. Please try again.');
          });
        }
      });

      // Timer
      setInterval(() => {
        const sec = Math.floor((Date.now() - startTime) / 1000);
        document.getElementById('timer').innerText = `Time elapsed: ${sec}s`;
      }, 1000);

      // Form submission
      function cleanObject(obj) {
        if (Array.isArray(obj)) return obj;
        if (typeof obj === 'object') {
          for (const k in obj) if (obj[k] === undefined) delete obj[k];
        }
        return obj;
      }
      
      function formToObj(frm) {
        const data = {};
        const formData = new FormData(frm);
        
        const checkboxGroups = new Set(
          Array.from(frm.querySelectorAll('input[type="checkbox"]')).map(input => input.name)
        );
        
        checkboxGroups.forEach(name => {
          data[name] = [];
        });
        
        formData.forEach((v, k) => {
          if (checkboxGroups.has(k)) {
            data[k].push(v);
          } else {
            data[k] = data[k] ? [].concat(data[k], v) : v;
          }
        });

        // Add survey number, timing, and device info to the payload
        data.surveyNum = surveyNum;
        data.readingPageTime = readingPageTime || "0";
        data.pageTimes = pageTimes;
        data.deviceType = getDeviceType();
        data.browserType = getBrowserType();
        data.navigationEvents = navigationEvents;
              
        return cleanObject(data);
      }
      
      document.getElementById('survey-form').onsubmit = async e => {
        e.preventDefault();
        const submitBtn = document.querySelector('#survey-form button[type="submit"]');
        if (submitBtn) {
          submitBtn.disabled = true;
          submitBtn.textContent = 'Submitting...'; // Show loading state
        }
        if (validatePage(currentPage, true)) {
          if (pageStartTime && currentPage <= pageTimes.length) {
            pageTimes[currentPage - 1] = ((Date.now() - pageStartTime) / 1000).toFixed(1);
          }
          if (currentPage === 3 && readingPageStartTime) {
            readingPageTime = ((Date.now() - readingPageStartTime) / 1000).toFixed(1);
          }
          const payload = formToObj(e.target);
          payload.totalTime = ((Date.now() - startTime) / 1000).toFixed(1);
          payload.readingPageTime = readingPageTime || "0";
          payload.pageTimes = pageTimes;
          payload.deviceType = getDeviceType();
          payload.browserType = getBrowserType();
          payload.navigationEvents = navigationEvents;
          payload.status = "complete";
          try {
            const response = await fetch('https://experimentsurvey.neeljaiswal23.workers.dev/api', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(payload)
            });
            if (response.ok) {
              alert('Thanks! Responses submitted to GitHub.');
              submitBtn.disabled = true;
              submitBtn.textContent = 'Submitted';
            } else {
              alert('Error submitting responses.');
              // Re-enable the button if there was an error
              if (submitBtn) {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit';
              }
            }
          } catch (err) {
            console.error('Submission failed:', err);
            alert('Error submitting responses.');
            if (submitBtn) {
              submitBtn.disabled = false;
              submitBtn.textContent = 'Submit';
            }
          }
        } else {
          if (submitBtn) {
            submitBtn.disabled = false;
            submitBtn.textContent = 'Submit';
          }
        }
      };

      // Initial setup
      showPage(currentPage);
    </script>
  </body>
</html>
